<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Referee Availability</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Goldman:wght@400;700&display=swap" rel="stylesheet">
        <style>
        #calendar-container {
            background-color: white;
            box-shadow: 2px 2px 10px 1px lightgray;
        }
        .calendar-headers, .calendar-cards {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
            gap: 5px 5px;
        }
        .calendar-cards {
            grid-template-rows: auto auto auto auto auto auto auto;
        }
        .calendar-headers {
            grid-template-rows: 1fr;
            padding-top: 0.5em;
            padding-bottom: 0.2em;
        }
        .calendar-card {
            padding: 0.5em;
            background-color: #dfffdf;
            position: relative;
            padding-bottom: 2.7em;
        }
        .calendar-header {
            text-align: center;
            font-family: "Audiowide", sans-serif;
            
        }
        .calendar-date {
            font-family: "Audiowide", sans-serif;
            font-size: 2.2em;
            color: #b0b0b0;
            position: absolute;
            bottom: 0.1em;
            left: 0.3em;
        }
        .calendar-card ul {
            margin-left: -2em;
            list-style: none;
        }
        .card-venue {
            margin: 0.1em;
            font-size: small;
            font-family: Calibri;
            cursor: pointer;
            font-weight: bold;
            user-select: none;
        }
        .card-venue::after {
            content: ">";
            margin-left: 0.5em;
            margin-top: 0.2em;
            position: absolute;
            transform: rotate(90deg);
        }
        .card-venue.closed::after {
            transform: rotate(0deg);
        }
        .card-venue.closed + .card-list {
            display: none;
        }
        #calendar-title {
            font-family: "Audiowide", sans-serif;
            text-align: center;
        }
        .card-label {
            font-size: small;
            font-family: Calibri;
        }
        .card-game {
            margin: 0.1em;
        }
        .card-list {
            margin: 0.1em;
            margin-left: -2em;
        }
        #btn-bin {
            background-color: white;
            padding: 1em;
            border: 1px solid black;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            column-gap: 3em;
            max-width: 25em;
            margin-left: auto;
            margin-right: auto;
        }
        #footer {
            position: fixed;
            bottom: 0px;
            width: 100%;
        }
        .game-ratio {
            margin-left: 0.25em;
            font-weight: normal;
        }
        body {
            font-family: Calibri;
            margin: 0;
            background-color: rgb(240, 240, 240);
            min-width: 1000px;
        }
        nav {
            background: linear-gradient(rgb(134, 160, 232), rgb(87, 133, 221), rgb(54, 95, 174) 100%);
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            color: white;
            column-gap: 3vw;
            padding: 0 3vw 0 3vw;
        }
        h1 {
            text-align: center;
        }
        #homepage {
            padding: 5em;
            width: 50vw;
            min-width: 500px;
            background-color: white;
            margin-right: auto;
            margin-left: auto;
            margin-top: 3em;
            margin-bottom: 2em;
            box-shadow: 2px 2px 10px 1px gray;
        }
        #calendar-main {
            padding: 1em;
        }
        h4 {
            margin-bottom: 0.2em;
        }
        h4 + p {
            margin-top: 0.2em;
        }
        #logo {
            font-family: "Goldman", sans-serif;
            font-weight: 400;
        }
        </style>
    </head>
    <body>
        <nav>
            <h2 id="logo">⚽ Game Time Assigning</h2>
            <h1>Availability Form</h1>
            <h3 id="conference">Suburban East &amp; Metro East Conferences 2024</h3>
        </nav>
        <div id="calendar-main">
            <h1 id="calendar-title">August</h1>
            <h2 id="league"></h2>
            <div id="calendar-container">
                <div class="calendar">
                    <div class="calendar-headers">
                        <div class="calendar-header">SUNDAY</div>
                        <div class="calendar-header">MONDAY</div>
                        <div class="calendar-header">TUESDAY</div>
                        <div class="calendar-header">WEDNESDAY</div>
                        <div class="calendar-header">THURSDAY</div>
                        <div class="calendar-header">FRIDAY</div>
                        <div class="calendar-header">SATURDAY</div>
                    </div>
                    <div class="calendar-cards" id="august-cards"></div>
                    <div class="calendar-cards" id="september-cards"></div>
                    <div class="calendar-cards" id="october-cards"></div>
                </div>
            </div>
        </div>
        <div id="homepage">
            <label for="referee-name"><b style="font-size: 1.3em;">Referee Name: </b></label>
            <input id="referee-name" placeholder="John Smith"></input>
            <br><br>
            <p>Summer soccer season is in full-swing and Minnesota high school soccer will be here before you know it! As a reminder, the new negotiated rate for high school varsity games in 2024 is $85, with no discounted rate for second games in a doubleheader. Rate for lower-level games is $70, also with no discounted rate for second game in a doubleheader.</p>

            <p>Also new this year is the offer to earn $10 off a membership to the Twin Cities Soccer Referee Organization (TCSRO) if you officiate ten or more games for my conferences or for Brian Wood’s conferences. TCSRO not only advocates for high school referees, they provide referee training, observation and learning material for members.</p>

            <p>For those of you interested in officiating high school this year, particularly the Metro East and Suburban East Conferences, I have created an online calendar for you to select games that work best for you and to help avoid repeat teams in your schedule. Please note that this will give me an indication of the games you would like, but it does not guarantee that you will get all games you select.</p>

 

            <p>I thank you in advance for officiating high school and for all your great work thus far this summer in rec and semi-pro leagues! </p>
            <hr style="margin-bottom: 1em; color: white;">
            <h2 style="margin-bottom: 0em;">Instructions</h2>
            <h4 style="margin-top: 0em;">How To Begin:</h4>
            <p>Enter your name at the top of this page.</p>
            <h4 style="margin-top: 0em;">Selecting Games</h4>
            <p>Please select the checkboxes of games you are interested in officiating for each day you are available. (NOTE: You may select more than one location for each day.) Use the "Next" and "Previous" buttons at the bottom of each page to navigate through August, September and October.</p>
            <h4>Sharing Your Selected Games:</h4>
            <p>After you have selected all games you are requesting, select "download availability" at the bottom of the page. Your file will download to your computer's Downloads folder "&lt;your_name&gt;.json". After you have located your file, please email it to <a href="mailto:gametimeassigning@gmail.com?subject=Highschool%20Availability">gametimeassigning@gmail.com</a>. This is not a file you will be able to open and view, as it is a file for scripting purposes on my end only.</p>
            <h4>Saving Your Progress</h4>
            <p>If you are unable to complete your selections in one sitting, you can save your progress by clicking "Save" at the bottom of the page. This will download your working file "&lt;your_name&gt;.html" to your computer's Downloads folder. When you return to complete your calendar, opening that file will ensure your progress was saved. This is a file that you can return to remind yourself of what games you selected.</p>
        </div>
        <div id="footer">
            <div id="btn-bin">
                <button id="previous-btn" class="btn" onclick="previousPage()">Previous</button>
                <a id="save-btn" class="btn" onclick="saveFile(arguments[0]);" href="#" download="page.html">save</a>
                <a id="availability-btn" class="btn" onclick="downloadAvailability(arguments[0]);" href="#" download="availability.json">download availability</a>
                <button id="next-btn" class="btn" onclick="nextPage()">Next</button>
            </div>
        </div>
        
    </body>
    <script>
		const september = 
`Game ID,Date,Time,Venue,Gender,Level,Home Team,Away Team
333-HSB24,09/03/2024,4:00 PM,Hill-Murray High School,Boys,B-Squad,Hill-Murray,Academy of Holy Angels
335-HSB24,09/03/2024,5:30 PM,Hill-Murray High School,Boys,JV,Hill-Murray,Academy of Holy Angels
534-HSB24,09/03/2024,4:00 PM,Two Rivers High School,Girls,C-Squad,Two Rivers,Benilde-St Margaret's
572-HSB24,09/03/2024,4:00 PM,White Bear Lake North High School,Girls,Grade 9,White Bear Lake,Andover
573-HSB24,09/03/2024,5:15 PM,White Bear Lake North High School,Girls,B-Squad,White Bear Lake,Andover
575-HSB24,09/04/2024,4:00 PM,White Bear Lake North High School,Boys,Grade 9,White Bear Lake,Irondale
576-HSB24,09/04/2024,5:15 PM,White Bear Lake North High School,Girls,Grade 9,White Bear Lake,Irondale
560-HSB24,09/05/2024,5:15 PM,North St Paul High School,Boys,JV,North St Paul,North St Paul
577-HSB24,09/05/2024,4:00 PM,White Bear Lake North High School,Boys,JV,White Bear Lake,Irondale
578-HSB24,09/05/2024,5:15 PM,White Bear Lake North High School,Girls,B-Squad,White Bear Lake,Irondale
393-HSB24,09/07/2024,11:00 AM,Simley High School,Boys,Varsity,Simley,St Croix Lutheran
538-HSB24,09/07/2024,3:00 PM,Two Rivers High School,Boys,C-Squad,Two Rivers,Eastview
579-HSB24,09/07/2024,11:00 AM,White Bear Lake North High School,Boys,JV,White Bear Lake,North St Paul
580-HSB24,09/07/2024,11:00 AM,White Bear Lake North High School,Boys,Grade 9,White Bear Lake,North St Paul
561-HSB24,09/09/2024,3:45 PM,North St Paul High School,Boys,JV,North St Paul,South St Paul
541-HSB24,09/10/2024,5:15 PM,Two Rivers High School,Boys,C-Squad,Two Rivers,Hastings
581-HSB24,09/10/2024,4:00 PM,White Bear Lake North High School,Boys,B-Squad,White Bear Lake,Mounds View
231-HSB24,09/11/2024,5:15 PM,Hastings High School,Boys,JV,Hastings,North St Paul
425-HSB24,09/11/2024,4:15 PM,Woodbury High School,Girls,Grade 9,Woodbury,Cretin-Derham Hall
347-HSB24,09/11/2024,3:45 PM,Hill-Murray High School,Boys,JV,Hill-Murray,Mahtomedi
582-HSB24,09/11/2024,4:00 PM,White Bear Lake North High School,Girls,Grade 9,White Bear Lake,Roseville
583-HSB24,09/11/2024,5:15 PM,White Bear Lake North High School,Boys,Grade 9,White Bear Lake,Roseville
584-HSB24,09/12/2024,4:00 PM,White Bear Lake North High School,Girls,JV,White Bear Lake,Roseville
585-HSB24,09/12/2024,5:15 PM,White Bear Lake North High School,Boys,JV,White Bear Lake,Roseville
152-HSB24,09/14/2024,1:00 PM,Forest Lake High School,Boys,Varsity,Forest Lake,Hastings
400-HSB24,09/14/2024,11:00 AM,Simley High School,Boys,JV,Simley,Rochester John Marshall
401-HSB24,09/14/2024,11:00 AM,Simley High School,Boys,C-Squad,Simley,Rochester John Marshall
543-HSB24,09/14/2024,1:00 PM,Two Rivers High School,Boys,B-Squad,Two Rivers,Woodbury
246-HSB24,09/17/2024,5:15 PM,Two Rivers High School,Boys,JV,Two Rivers,North St Paul
513-HSB24,09/17/2024,4:15 PM,St Thomas Academy,Boys,JV,St Thomas Academy,Simley
545-HSB24,09/17/2024,4:00 PM,Two Rivers High School,Boys,B-Squad,Two Rivers,Tartan
587-HSB24,09/17/2024,4:00 PM,White Bear Lake North High School,Girls,B-Squad,White Bear Lake,East Ridge
588-HSB24,09/17/2024,5:15 PM,White Bear Lake North High School,Boys,B-Squad,White Bear Lake,East Ridge
404-HSB24,09/18/2024,5:15 PM,Simley High School,Boys,C-Squad,Simley,St Thomas Academy
515-HSB24,09/21/2024,10:00 AM,St Thomas Academy,Boys,C-Squad,St Thomas Academy,Cretin-Derham Hall
593-HSB24,09/23/2024,4:00 PM,White Bear Lake North High School,Girls,Grade 9,White Bear Lake,Woodbury
594-HSB24,09/23/2024,5:15 PM,White Bear Lake North High School,Boys,Grade 9,White Bear Lake,Woodbury
234-HSB24,09/24/2024,3:45 PM,Hastings High School,Boys,JV,Hastings,Hill-Murray
235-HSG24,09/24/2024,5:15 PM,Hastings High School,Girls,JV,Hastings,Hill-Murray
595-HSB24,09/24/2024,4:00 PM,White Bear Lake North High School,Girls,JV,White Bear Lake,Woodbury
596-HSB24,09/24/2024,5:15 PM,White Bear Lake North High School,Boys,JV,White Bear Lake,Woodbury
184-HSB24,09/26/2024,7:00 PM,Hastings High School,Boys,Varsity,Hastings,St Thomas Academy
235-HSB24,09/26/2024,5:15 PM,Hastings High School,Boys,JV,Hastings,St Thomas Academy
366-HSB24,09/26/2024,3:45 PM,Hill-Murray High School,Girls,JV,Hill-Murray,Two Rivers
367-HSB24,09/26/2024,5:15 PM,Hill-Murray High School,Boys,JV,Hill-Murray,Two Rivers
550-HSB24,09/27/2024,4:00 PM,Two Rivers High School,Boys,C-Squad,Two Rivers,Hill-Murray
524-HSB24,09/28/2024,12:00 PM,St Thomas Academy,Boys,B-Squad,St Thomas Academy,Roseville
551-HSB24,09/30/2024,3:45 PM,Two Rivers High School,Boys,B-Squad,Two Rivers,St Thomas Academy`
		const october = 
`Game ID,Date,Time,Venue,Gender,Level,Home Team,Away Team
194-HSG24,10/01/2024,7:00 PM,Forest Lake High School,Girls,Varsity,Forest Lake,Woodbury
200-HSB24,10/01/2024,5:00 PM,Forest Lake High School,Boys,Varsity,Forest Lake,Woodbury
245-HSG24,10/01/2024,5:15 PM,Two Rivers High School,Girls,JV,Two Rivers,Simley
248-HSB24,10/01/2024,3:45 PM,Two Rivers High School,Boys,JV,Two Rivers,Simley
373-HSB24,10/01/2024,4:15 PM,Hill-Murray High School,Boys,B-Squad,Hill-Murray,Rosemount
563-HSB24,10/01/2024,5:15 PM,North St Paul High School,Boys,JV,North St Paul,Hill-Murray
526-HSB24,10/01/2024,4:15 PM,St Thomas Academy,Boys,JV,St Thomas Academy,Tartan
599-HSB24,10/01/2024,4:00 PM,White Bear Lake North High School,Boys,JV,White Bear Lake,Stillwater
600-HSB24,10/01/2024,5:15 PM,White Bear Lake North High School,Girls,JV,White Bear Lake,Stillwater
236-HSB24,10/02/2024,5:15 PM,Hastings High School,Boys,C-Squad,Hastings,South St Paul
236-HSG24,10/02/2024,3:45 PM,Hastings High School,Girls,C-Squad,Hastings,South St Paul
376-HSB24,10/02/2024,7:00 PM,Hill-Murray High School,Boys,B-Squad,Hill-Murray,Hill-Murray
413-HSB24,10/02/2024,3:45 PM,Simley High School,Boys,C-Squad,Simley,Two Rivers
414-HSB24,10/02/2024,5:15 PM,Simley High School,Girls,C-Squad,Simley,Two Rivers
415-HSB24,10/03/2024,3:45 PM,Simley High School,Boys,JV,Simley,Hastings
416-HSB24,10/03/2024,5:15 PM,Simley High School,Girls,JV,Simley,Hastings
601-HSB24,10/03/2024,5:15 PM,White Bear Lake North High School,Boys,B-Squad,White Bear Lake,Cretin-Derham Hall
211-HSG24,10/05/2024,1:00 PM,Forest Lake High School,Girls,Varsity,Forest Lake,Blaine
215-HSB24,10/05/2024,1:00 PM,South St Paul High School,Girls,JV,South St Paul,Duluth East`

		const calendars = {
			"september": september,
			"october": october,
		}
        
        function parse_csv(csv) {
            const lines = csv.split("\n");
            const headers = lines[0].split(",");
            const body = lines.slice(1);
            const data = [];
            for (line of body) {
                let datum = {}
                let line_data = line.split(",");
                for (let i = 0; i < headers.length; i++) {
                    datum[headers[i]] = line_data[i];
                }
                data.push(datum);
            }
            return data;
        }

        function handleVenueCheckboxChange(evt) {
            // check all game checkboxes
            let div = evt.target.parentElement.parentElement;
            let checkboxes = div.getElementsByClassName("card-checkbox");
            for (let checkbox of checkboxes) {
                if (checkbox.checked != evt.target.checked) {
                    checkbox.checked = evt.target.checked;
                    var event = new Event("change");
                    checkbox.dispatchEvent(event);
                }
            }

            // permanent check
            const parent = evt.target.parentElement;
            const index = [].indexOf.call(parent.childNodes, evt.target);
            if (evt.target.checked) {
                evt.target.outerHTML = evt.target.outerHTML.replace(">", " checked>");
            } else {
                evt.target.outerHTML = evt.target.outerHTML.replace(' checked=""', "");
            }
            parent.childNodes[index].addEventListener("click", handleVenueCheckboxChange);


        }

        function handleGameCheckboxChange(evt) {
            const parent = evt.target.parentElement;
            const index = [].indexOf.call(parent.childNodes, evt.target);
            const div = evt.target.parentElement.parentElement.parentElement;
            const selectedGamesEl = div.getElementsByClassName("selected-games")[0];
            const totalGamesEl = div.getElementsByClassName("total-games")[0];
            const selectedGames = parseInt(selectedGamesEl.innerText);
            const totalGames = parseInt(totalGamesEl.innerText);
            if (evt.target.checked) {
                evt.target.outerHTML = evt.target.outerHTML.replace(">", " checked>");
                selectedGamesEl.innerText = selectedGames + 1;
                if (selectedGames + 1 === totalGames) {
                    let checkbox = div.getElementsByClassName("venue-checkbox")[0];
                    checkbox.checked = true;
                }
                
            } else {
                evt.target.outerHTML = evt.target.outerHTML.replace(' checked=""', "");
                selectedGamesEl.innerText = selectedGames - 1;
                let checkbox = div.getElementsByClassName("venue-checkbox")[0];
                checkbox.checked = false;
            }
            parent.childNodes[index].addEventListener("change", handleGameCheckboxChange);

        }

        function createVenueContainer(venue, cardData) {
            divEl = document.createElement("div");
            listEl = document.createElement("ul");
            listEl.className="card-list";

            let venueEl = document.createElement("p");
            venueEl.className = "card-venue closed";
            venueEl.addEventListener("click", (evt) => {
                if (evt.target.className.search("venue-checkbox")){
                    evt.currentTarget.classList.toggle("closed");
                }
            });

            let venueCheckbox = document.createElement("input");
            venueCheckbox.type = "checkbox";
            venueCheckbox.className = "venue-checkbox";
            venueCheckbox.addEventListener("click", handleVenueCheckboxChange);
            venueEl.appendChild(venueCheckbox);

            let textNode = document.createTextNode(venue);
            venueEl.appendChild(textNode);

            let gameRatioSpan = document.createElement("span");
            gameRatioSpan.className = "game-ratio";
            textNode = document.createTextNode("(");
            gameRatioSpan.appendChild(textNode);

            let selectedGames = document.createElement("span");
            selectedGames.className = "selected-games";
            selectedGames.innerText = "0";
            gameRatioSpan.appendChild(selectedGames);

            textNode = document.createTextNode("/");
            gameRatioSpan.appendChild(textNode);

            
            let totalGamesEl = document.createElement("span");
            totalGamesEl.className = "total-games";
            let totalGames = cardData.filter((a) => {return a["Venue"] === venue;}).length;
            totalGamesEl.innerText = `${totalGames}`
            gameRatioSpan.appendChild(totalGamesEl);

            textNode = document.createTextNode(")");
            gameRatioSpan.appendChild(textNode);
            
            venueEl.appendChild(gameRatioSpan);
            divEl.appendChild(venueEl);
            divEl.appendChild(listEl);

            return divEl;

        }

        function appendGameToVenueContainer(venueContainer, data) {

            let listEl = venueContainer.getElementsByTagName("ul")[0];

            const listItem = document.createElement("li");
            const label = document.createElement("label");
            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.id = `availability-${data["Game ID"]}`;
            checkbox.name = data["Game ID"];
            checkbox.className = "card-checkbox";
            checkbox.addEventListener("change", handleGameCheckboxChange);
            label.innerText = `${data["Gender"]} ${data["Level"]} ${data["Time"]}`;
            label.htmlFor = checkbox.id;
            label.className = "card-label";
            listItem.appendChild(checkbox);
            listItem.appendChild(label);
            listItem.className = "card-game";
            listEl.appendChild(listItem);
        }

        function createCard(day, cardData){
            let gamesAdded = 0;
            const cardEl = document.createElement("div");
            cardEl.className = "calendar-card";
            if (day > 0) {
                let dayEl = document.createElement("div");
                dayEl.className = "calendar-date";
                dayEl.innerText = day;
                cardEl.appendChild(dayEl);
            }
            if (cardData) {
                let prevVenue = "";
                let venueContainer = null;
                for (data of cardData) {
                    let venue = data["Venue"];

                    if (venue != prevVenue) {
                        venueContainer = createVenueContainer(venue, cardData);
                        cardEl.appendChild(venueContainer);
                        prevVenue = venue;
                    }

                    appendGameToVenueContainer(venueContainer, data);
                    gamesAdded ++;

                }
            }
            return { cardEl, gamesAdded };
        }

        function generateCalendars() {
            for (let key in calendars) {

                const calendar = document.getElementById(`${key}-cards`);
                if (calendar.innerHTML != "") {
                    continue;
                }

                const calendarData = parse_csv(calendars[key]);
                calendarData.sort((a, b) => new Date(a["Date"] + " " + a["Time"]) < new Date(b["Date"] + " " + b["Time"]) ? 1 : -1);
                calendarData.sort((a, b) => a["Venue"] < b["Venue"] ? 1 : -1);
                calendarData.sort((a, b) => new Date(a["Date"]) < new Date(b["Date"]) ? 1 : -1);

                const date = new Date(`${key} 1, 2024`);

                let cards = 0;
                let totalGames = calendarData.length;
                let totalGamesAdded = 0;

                for (let i = 0; i < date.getDay(); i ++) {
                    let { cardEl, gamesAdded } = createCard(0);
                    calendar.appendChild(cardEl);
                    cards ++;
                }

                do {
                    let cardData = [];
                    if (calendarData.length == 0) {
                        break;
                    }
                    let game = calendarData.pop();
                    let gameDate = new Date(game["Date"]);
                    while (gameDate.valueOf() == date.valueOf()) {
                        cardData.push(game);
                        if (calendarData.length == 0) {
                            break;
                        }
                        game = calendarData.pop();
                        gameDate = new Date(game["Date"]);
                    }
                    calendarData.push(game);

                    let { cardEl, gamesAdded } = createCard(date.getDate(), cardData);
                    totalGamesAdded += gamesAdded;
                    calendar.appendChild(cardEl);
                    cards ++;
                    date.setDate(date.getDate() + 1);

                } while (date.getDate() > 1);

                while (cards < 7 * 5) {
                    let { cardEl, gamesAdded } = createCard(0);
                    calendar.appendChild(cardEl);
                    cards ++;
                }
                if (totalGamesAdded != totalGames) {
                    alert("something went wrong");
                }
            }
        }

        let page = "home";
        const pages = ["home", "august", "september", "october"];

        function switchPage(page) {
            let homepage = document.getElementById("homepage");
            let calendarpage = document.getElementById("calendar-main");
            let augustCards = document.getElementById("august-cards");
            let septemberCards = document.getElementById("september-cards");
            let octoberCards = document.getElementById("october-cards");
            if (page === "home") {
                homepage.style.display = "block";
                calendarpage.style.display = "none";
            } else {
                homepage.style.display = "none";
                calendarpage.style.display = "block";
                if (page === "august") {
                    augustCards.style.display = "grid";
                    septemberCards.style.display = "none";
                    octoberCards.style.display = "none";
                    document.getElementById("calendar-title").innerText = "August";
                } else if (page === "september") {
                    augustCards.style.display = "none";
                    septemberCards.style.display = "grid";
                    octoberCards.style.display = "none";
                    document.getElementById("calendar-title").innerText = "September";
                } else if (page === "october") {
                    augustCards.style.display = "none";
                    septemberCards.style.display = "none";
                    octoberCards.style.display = "grid";
                    document.getElementById("calendar-title").innerText = "October";
                }
            }

            let index = pages.indexOf(page);
            const nextBtn = document.getElementById("next-btn");
            const prevBtn = document.getElementById("previous-btn");
            if (index === pages.length-1) {
                nextBtn.disabled = true;
            } else {
                nextBtn.disabled = false;
            }
            if (index == 0) {
                prevBtn.disabled = true;
            } else {
                prevBtn.disabled = false;
            }
        }

        function nextPage() {
            let index = pages.indexOf(page);
            if (index == pages.length - 1) {
                alert("Already at the last page!");
                return;
            } else {
                page = pages[index + 1];
                switchPage(page);
            }
        }
        function previousPage() {
            let index = pages.indexOf(page);
            if (index == 0) {
                alert("Already at the first page!");
                return;
            } else {
                page = pages[index - 1];
                switchPage(page);
            }
        }

        function saveFile(evt) {
            const nameField = document.getElementById("referee-name");
            if (nameField == null || nameField.value === "") {
                evt.preventDefault();
                alert("You must fill out the referee name field on the first page!");
            } else {
                let name = nameField.value.replaceAll(" ", "_");
                name = name.replaceAll("[^A-z_]", "");
                evt.target.download = name;
                evt.target.href='data:text/html;charset=UTF-8,'+encodeURIComponent(document.documentElement.outerHTML)
            }
        }

        function downloadAvailability(evt) {
            const nameField = document.getElementById("referee-name");
            if (nameField == null || nameField.value === "") {
                evt.preventDefault();
                alert("You must fill out the referee name field on the first page!");
            } else {

                let name = nameField.value.replaceAll(" ", "_");
                let json = {
                    name: nameField.value,
                    availabileFor: [],
                };
                let checkboxes = document.getElementsByClassName("card-checkbox");
                for (let checkbox of checkboxes) {
                    if (checkbox.checked) {
                        json.availabileFor.push(checkbox.name);
                    }
                }
                name = name.replaceAll("[^A-z_]", "");
                evt.target.download = name;
                evt.target.href='data:application/json;charset=UTF-8,'+JSON.stringify(json);
            }
        }

        switchPage("home");
        generateCalendars();
        window.addEventListener("beforeunload", function (e) {
            var confirmationMessage = 'It looks like you have been editing something. '
                                    + 'If you leave before saving, your changes will be lost.';

            (e || window.event).returnValue = confirmationMessage; //Gecko + IE
            return confirmationMessage; //Gecko + Webkit, Safari, Chrome etc.
        });
    </script>
</html>
