<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Referee Availability</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Goldman:wght@400;700&display=swap" rel="stylesheet">
        <style>
        #calendar-container {
            background-color: white;
            box-shadow: 2px 2px 10px 1px lightgray;
        }
        .calendar-headers, .calendar-cards {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
            gap: 5px 5px;
        }
        .calendar-cards {
            grid-template-rows: auto auto auto auto auto auto auto;
        }
        .calendar-headers {
            grid-template-rows: 1fr;
            padding-top: 0.5em;
            padding-bottom: 0.2em;
        }
        .calendar-card {
            padding: 0.5em;
            background-color: #dfffdf;
            position: relative;
            padding-bottom: 2.7em;
        }
        .calendar-header {
            text-align: center;
            font-family: "Audiowide", sans-serif;
            
        }
        .calendar-date {
            font-family: "Audiowide", sans-serif;
            font-size: 2.2em;
            color: #b0b0b0;
            position: absolute;
            bottom: 0.1em;
            left: 0.3em;
        }
        .calendar-card ul {
            margin-left: -2em;
            list-style: none;
        }
        .card-venue {
            margin: 0.1em;
            font-size: small;
            font-family: Calibri;
            cursor: pointer;
            font-weight: bold;
            user-select: none;
        }
        .card-venue::after {
            content: ">";
            margin-left: 0.5em;
            margin-top: 0.2em;
            position: absolute;
            transform: rotate(90deg);
        }
        .card-venue.closed::after {
            transform: rotate(0deg);
        }
        .card-venue.closed + .card-list {
            display: none;
        }
        #calendar-title {
            font-family: "Audiowide", sans-serif;
            text-align: center;
        }
        .card-label {
            font-size: small;
            font-family: Calibri;
        }
        .card-game {
            margin: 0.1em;
        }
        .card-list {
            margin: 0.1em;
            margin-left: -2em;
        }
        #btn-bin {
            background-color: white;
            padding: 1em;
            border: 1px solid black;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            column-gap: 3em;
            max-width: 25em;
            margin-left: auto;
            margin-right: auto;
        }
        #footer {
            position: fixed;
            bottom: 0px;
            width: 100%;
        }
        .game-ratio {
            margin-left: 0.25em;
            font-weight: normal;
        }
        body {
            font-family: Calibri;
            margin: 0;
            background-color: rgb(240, 240, 240);
            min-width: 1000px;
        }
        nav {
            background: linear-gradient(rgb(134, 160, 232), rgb(87, 133, 221), rgb(54, 95, 174) 100%);
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            color: white;
            column-gap: 3vw;
            padding: 0 3vw 0 3vw;
        }
        h1 {
            text-align: center;
        }
        #homepage {
            padding: 5em;
            width: 50vw;
            min-width: 500px;
            background-color: white;
            margin-right: auto;
            margin-left: auto;
            margin-top: 3em;
            margin-bottom: 2em;
            box-shadow: 2px 2px 10px 1px gray;
        }
        #calendar-main {
            padding: 1em;
        }
        h4 {
            margin-bottom: 0.2em;
        }
        h4 + p {
            margin-top: 0.2em;
        }
        #logo {
            font-family: "Goldman", sans-serif;
            font-weight: 400;
        }
        </style>
    </head>
    <body>
        <nav>
            <h2 id="logo">⚽ Game Time Assigning</h2>
            <h1>Availability Form</h1>
            <h3 id="conference">Suburban East &amp; Metro East Conferences 2024</h3>
        </nav>
        <div id="calendar-main">
            <h1 id="calendar-title">August</h1>
            <h2 id="league"></h2>
            <div id="calendar-container">
                <div class="calendar">
                    <div class="calendar-headers">
                        <div class="calendar-header">SUNDAY</div>
                        <div class="calendar-header">MONDAY</div>
                        <div class="calendar-header">TUESDAY</div>
                        <div class="calendar-header">WEDNESDAY</div>
                        <div class="calendar-header">THURSDAY</div>
                        <div class="calendar-header">FRIDAY</div>
                        <div class="calendar-header">SATURDAY</div>
                    </div>
                    <div class="calendar-cards" id="august-cards"></div>
                    <div class="calendar-cards" id="september-cards"></div>
                    <div class="calendar-cards" id="october-cards"></div>
                </div>
            </div>
        </div>
        <div id="homepage">
            <label for="referee-name"><b style="font-size: 1.3em;">Referee Name: </b></label>
            <input id="referee-name" placeholder="John Smith"></input>
            <br><br>
            <p>Summer soccer season is in full-swing and Minnesota high school soccer will be here before you know it! As a reminder, the new negotiated rate for high school varsity games in 2024 is $85, with no discounted rate for second games in a doubleheader. Rate for lower-level games is $70, also with no discounted rate for second game in a doubleheader.</p>

            <p>Also new this year is the offer to earn $10 off a membership to the Twin Cities Soccer Referee Organization (TCSRO) if you officiate ten or more games for my conferences or for Brian Wood’s conferences. TCSRO not only advocates for high school referees, they provide referee training, observation and learning material for members.</p>

            <p>For those of you interested in officiating high school this year, particularly the Metro East and Suburban East Conferences, I have created an online calendar for you to select games that work best for you and to help avoid repeat teams in your schedule. Please note that this will give me an indication of the games you would like, but it does not guarantee that you will get all games you select.</p>

 

            <p>I thank you in advance for officiating high school and for all your great work thus far this summer in rec and semi-pro leagues! </p>
            <hr style="margin-bottom: 1em; color: white;">
            <h2 style="margin-bottom: 0em;">Instructions</h2>
            <h4 style="margin-top: 0em;">How To Begin:</h4>
            <p>Enter your name at the top of this page.</p>
            <h4 style="margin-top: 0em;">Selecting Games</h4>
            <p>Please select the checkboxes of games you are interested in officiating for each day you are available. (NOTE: You may select more than one location for each day.) Use the "Next" and "Previous" buttons at the bottom of each page to navigate through August, September and October.</p>
            <h4>Sharing Your Selected Games:</h4>
            <p>After you have selected all games you are requesting, select "download availability" at the bottom of the page. Your file will download to your computer's Downloads folder "&lt;your_name&gt;.json". After you have located your file, please email it to <a href="mailto:gametimeassigning@gmail.com?subject=Highschool%20Availability">gametimeassigning@gmail.com</a>. This is not a file you will be able to open and view, as it is a file for scripting purposes on my end only.</p>
            <h4>Saving Your Progress</h4>
            <p>If you are unable to complete your selections in one sitting, you can save your progress by clicking "Save" at the bottom of the page. This will download your working file "&lt;your_name&gt;.html" to your computer's Downloads folder. When you return to complete your calendar, opening that file will ensure your progress was saved. This is a file that you can return to remind yourself of what games you selected.</p>
        </div>
        <div id="footer">
            <div id="btn-bin">
                <button id="previous-btn" class="btn" onclick="previousPage()">Previous</button>
                <a id="save-btn" class="btn" onclick="saveFile(arguments[0]);" href="#" download="page.html">save</a>
                <a id="availability-btn" class="btn" onclick="downloadAvailability(arguments[0]);" href="#" download="availability.json">download availability</a>
                <button id="next-btn" class="btn" onclick="nextPage()">Next</button>
            </div>
        </div>
        
    </body>
    <script>
		const august = 
`Game ID,Date,Start Time,Venue,Age Group,Gender,Home Team,Away Team
553-HSB24,08/22/2024,15:30:00,Hastings High School,C-Squad,Boys,Hastings,Eastview
602-HSB24,08/22/2024,15:30:00,White Bear Lake North High School,JV,Boys,White Bear Lake,Centennial
554-HSB24,08/22/2024,17:00:00,Hastings High School,JV,Boys,Hastings,Eastview
603-HSB24,08/22/2024,17:15:00,White Bear Lake North High School,JV,Girls,White Bear Lake,Centennial
555-HSB24,08/22/2024,17:00:00,White Bear Lake North High School,Varsity,Boys,White Bear Lake,Centennial
605-HSB24,08/23/2024,15:00:00,White Bear Lake North High School,Grade 9,Boys,White Bear Lake,Duluth East
606-HSB24,08/23/2024,17:00:00,White Bear Lake North High School,B-Squad,Boys,White Bear Lake,Duluth East
424-HSB24,08/24/2024,09:00:00,Courtly Park Fields,B-Squad,Boys,Woodbury,Saint Thomas Academy
559-HSB24,08/24/2024,11:00:00,North St Paul High School,JV,Boys,North St Paul,Minneapolis Edison
386-HSB24,08/24/2024,11:00:00,Simley High School,JV,Boys,Simley,Apple Valley
502-HSB24,08/26/2024,16:00:00,St Thomas Academy,B-Squad,Boys,St Thomas Academy,Benilde-St Margaret's
216-HSB24,08/26/2024,17:00:00,South St Paul High School,C,Girls,South St Paul,Byron
528-HSB24,08/26/2024,14:00:00,Two Rivers High School,C-Squad,Girls,Two Rivers,Rochester John Marshall
242-HSG24,08/26/2024,14:00:00,Two Rivers High School,JV,Girls,Two Rivers,Rochester John Marshall
226-HSG24,08/27/2024,15:00:00,Hastings High School,JV,Girls,Hastings,Shakopee
530-HSB24,08/27/2024,16:00:00,Two Rivers High School,B-Squad,Boys,Two Rivers,St Paul Central
529-HSB24,08/27/2024,16:00:00,Two Rivers High School,C-Squad,Boys,Two Rivers,St Paul Central
607-HSB24,08/27/2024,16:00:00,White Bear Lake North High School,Grade 9,Girls,White Bear Lake,Mahtomedi
223-HSB24,08/27/2024,16:30:00,Hastings High School,JV,Boys,Hastings,Irondale
608-HSB24,08/27/2024,17:15:00,White Bear Lake North High School,B-Squad,Girls,White Bear Lake,Mahtomedi
609-HSB24,08/27/2024,17:30:00,White Bear Lake North High School,JV,Girls,White Bear Lake,Mahtomedi
567-HSB24,08/28/2024,14:30:00,White Bear Lake North High School,Grade 9,Girls,White Bear Lake,Eagan
566-HSB24,08/28/2024,14:30:00,White Bear Lake North High School,Grade 9,Boys,White Bear Lake,Eagan
569-HSB24,08/28/2024,16:00:00,White Bear Lake North High School,B-Squad,Girls,White Bear Lake,Eagan
568-HSB24,08/28/2024,16:00:00,White Bear Lake North High School,B-Squad,Boys,White Bear Lake,Eagan
328-HSB24,08/28/2024,17:15:00,Hill-Murray High School,C-Squad,Girls,Hill-Murray,East Ridge
571-HSB24,08/28/2024,17:15:00,White Bear Lake North High School,JV,Girls,White Bear Lake,Eagan
570-HSB24,08/28/2024,17:15:00,White Bear Lake North High School,JV,Boys,White Bear Lake,Eagan
531-HSB24,08/29/2024,15:00:00,Two Rivers High School,C-Squad,Boys,Two Rivers,Stillwater
532-HSB24,08/29/2024,15:00:00,Two Rivers High School,B-Squad,Boys,Two Rivers,Stillwater
330-HSB24,08/29/2024,15:30:00,Hill-Murray High School,JV,Girls,Hill-Murray,East Ridge
392-HSB24,08/29/2024,16:00:00,Simley High School,C-Squad,Boys,Simley,St Croix Lutheran
391-HSB24,08/29/2024,16:00:00,Simley High School,JV,Boys,Simley,St Croix Lutheran
503-HSB24,08/29/2024,16:00:00,St Thomas Academy,B-Squad,Boys,St Thomas Academy,Academy of Holy Angels
533-HSB24,08/29/2024,17:00:00,Two Rivers High School,C-Squad,Girls,Two Rivers,Minnetonka
331-HSB24,08/29/2024,17:15:00,Hill-Murray High School,JV,Boys,Hill-Murray,East Ridge
505-HSB24,08/29/2024,17:15:00,St Thomas Academy,C-Squad,Boys,St Thomas Academy,Academy of Holy Angels
393-HSB24,08/29/2024,18:00:00,Simley High School,Varsity,Boys,Simley,St Croix Lutheran`
		const september = 
`Game ID,Date,Start Time,Venue,Age Group,Gender,Home Team,Away Team
228-HSG24,09/03/2024,15:30:00,Hastings High School,C-Squad,Girls,Hastings,Burnsville
227-HSB24,09/03/2024,15:30:00,Hastings High School,C-Squad,Boys,Hastings,Burnsville
333-HSB24,09/03/2024,16:00:00,Hill-Murray High School,B-Squad,Boys,Hill-Murray,Academy of Holy Angels
534-HSB24,09/03/2024,16:00:00,Two Rivers High School,C-Squad,Girls,Two Rivers,Benilde-St Margaret's
572-HSB24,09/03/2024,16:00:00,White Bear Lake North High School,Grade 9,Girls,White Bear Lake,Andover
229-HSG24,09/03/2024,17:00:00,Hastings High School,JV,Girls,Hastings,Burnsville
419-HSB24,09/03/2024,17:00:00,Tartan High School,Varsity,Girls,Tartan,St Paul Central
573-HSB24,09/03/2024,17:15:00,White Bear Lake North High School,B-Squad,Girls,White Bear Lake,Andover
335-HSB24,09/03/2024,17:30:00,Hill-Murray High School,JV,Boys,Hill-Murray,Academy of Holy Angels
574-HSB24,09/03/2024,17:30:00,White Bear Lake North High School,JV,Girls,White Bear Lake,Andover
319-HSB24,09/03/2024,19:00:00,White Bear Lake North High School,Varsity,Girls,White Bear Lake,Andover
575-HSB24,09/04/2024,16:00:00,White Bear Lake North High School,Grade 9,Boys,White Bear Lake,Irondale
576-HSB24,09/04/2024,17:15:00,White Bear Lake North High School,Grade 9,Girls,White Bear Lake,Irondale
577-HSB24,09/05/2024,16:00:00,White Bear Lake North High School,JV,Boys,White Bear Lake,Irondale
560-HSB24,09/05/2024,17:15:00,North St Paul High School,JV,Boys,North St Paul,North St Paul
578-HSB24,09/05/2024,17:15:00,White Bear Lake North High School,B-Squad,Girls,White Bear Lake,Irondale
339-HSB24,09/06/2024,15:45:00,Hill-Murray High School,C-Squad,Girls,Hill-Murray,Simley
579-HSB24,09/07/2024,11:00:00,White Bear Lake North High School,JV,Boys,White Bear Lake,North St Paul
580-HSB24,09/07/2024,11:00:00,White Bear Lake North High School,Grade 9,Boys,White Bear Lake,North St Paul
539-HSB24,09/07/2024,15:00:00,Two Rivers High School,B-Squad,Boys,Two Rivers,Eastview
538-HSB24,09/07/2024,15:00:00,Two Rivers High School,C-Squad,Boys,Two Rivers,Eastview
561-HSB24,09/09/2024,15:45:00,North St Paul High School,JV,Boys,North St Paul,South St Paul
581-HSB24,09/10/2024,16:00:00,White Bear Lake North High School,B-Squad,Boys,White Bear Lake,Mounds View
541-HSB24,09/10/2024,17:15:00,Two Rivers High School,C-Squad,Boys,Two Rivers,Hastings
347-HSB24,09/11/2024,15:45:00,Hill-Murray High School,JV,Boys,Hill-Murray,Mahtomedi
582-HSB24,09/11/2024,16:00:00,White Bear Lake North High School,Grade 9,Girls,White Bear Lake,Roseville
425-HSB24,09/11/2024,16:15:00,Courtly Park Fields,Grade 9,Girls,Woodbury,Cretin-Derham Hall
511-HSB24,09/11/2024,16:15:00,St Thomas Academy,JV,Boys,St Thomas Academy,South St Paul
231-HSB24,09/11/2024,17:15:00,Hastings High School,JV,Boys,Hastings,North St Paul
348-HSB24,09/11/2024,17:15:00,Hill-Murray High School,JV,Girls,Hill-Murray,Mahtomedi
583-HSB24,09/11/2024,17:15:00,White Bear Lake North High School,Grade 9,Boys,White Bear Lake,Roseville
584-HSB24,09/12/2024,16:00:00,White Bear Lake North High School,JV,Girls,White Bear Lake,Roseville
585-HSB24,09/12/2024,17:15:00,White Bear Lake North High School,JV,Boys,White Bear Lake,Roseville
401-HSB24,09/14/2024,11:00:00,Simley High School,C-Squad,Boys,Simley,Rochester John Marshall
400-HSB24,09/14/2024,11:00:00,Simley High School,JV,Boys,Simley,Rochester John Marshall
402-HSB24,09/14/2024,11:00:00,Simley High School,Varsity,Girls,Simley,Burnsville
586-HSB24,09/14/2024,11:00:00,White Bear Lake North High School,JV,Boys,White Bear Lake,South St Paul
152-HSB24,09/14/2024,13:00:00,Forest Lake High School,Varsity,Boys,Forest Lake,Hastings
157-HSG24,09/14/2024,13:00:00,Hastings High School,Varsity,Girls,Hastings,Minnetonka
403-HSB24,09/14/2024,13:00:00,Simley High School,Varsity,Boys,Simley,Rochester John Marshall
542-HSB24,09/14/2024,13:00:00,Two Rivers High School,C-Squad,Boys,Two Rivers,Woodbury
543-HSB24,09/14/2024,13:00:00,Two Rivers High School,B-Squad,Boys,Two Rivers,Woodbury
545-HSB24,09/17/2024,16:00:00,Two Rivers High School,B-Squad,Boys,Two Rivers,Tartan
587-HSB24,09/17/2024,16:00:00,White Bear Lake North High School,B-Squad,Girls,White Bear Lake,East Ridge
513-HSB24,09/17/2024,16:15:00,St Thomas Academy,JV,Boys,St Thomas Academy,Simley
154-HSB24,09/17/2024,17:00:00,Mahtomedi High School,Varsity,Boys,Mahtomedi,Hastings
246-HSB24,09/17/2024,17:15:00,Two Rivers High School,JV,Boys,Two Rivers,North St Paul
588-HSB24,09/17/2024,17:15:00,White Bear Lake North High School,B-Squad,Boys,White Bear Lake,East Ridge
163-HSG24,09/17/2024,19:00:00,Mahtomedi High School,Varsity,Girls,Mahtomedi,Hastings
589-HSB24,09/18/2024,16:00:00,White Bear Lake North High School,Grade 9,Boys,White Bear Lake,Park
404-HSB24,09/18/2024,17:15:00,Simley High School,C-Squad,Boys,Simley,St Thomas Academy
590-HSB24,09/18/2024,17:15:00,White Bear Lake North High School,Grade 9,Girls,White Bear Lake,Park
591-HSB24,09/19/2024,16:00:00,White Bear Lake North High School,JV,Boys,White Bear Lake,Park
405-HSB24,09/19/2024,17:15:00,Simley High School,JV,Boys,Simley,North St Paul
514-HSB24,09/19/2024,16:15:00,St Thomas Academy,JV,Boys,St Thomas Academy,Mahtomedi
592-HSB24,09/19/2024,17:15:00,White Bear Lake North High School,JV,Girls,White Bear Lake,Park
170-HSG24,09/19/2024,19:00:00,Woodbury High School,Varsity,Girls,Woodbury,Irondale
515-HSB24,09/21/2024,10:00:00,St Thomas Academy,C-Squad,Boys,St Thomas Academy,Cretin-Derham Hall
517-HSB24,09/21/2024,12:00:00,St Thomas Academy,B-Squad,Boys,St Thomas Academy,Cretin-Derham Hall
516-HSB24,09/21/2024,12:00:00,St Thomas Academy,JV,Boys,St Thomas Academy,Cretin-Derham Hall
518-HSB24,09/23/2024,16:00:00,St Thomas Academy,B-Squad,Boys,St Thomas Academy,Hill-Murray
593-HSB24,09/23/2024,16:00:00,White Bear Lake North High School,Grade 9,Girls,White Bear Lake,Woodbury
594-HSB24,09/23/2024,17:15:00,White Bear Lake North High School,Grade 9,Boys,White Bear Lake,Woodbury
595-HSB24,09/24/2024,16:00:00,White Bear Lake North High School,JV,Girls,White Bear Lake,Woodbury
596-HSB24,09/24/2024,17:15:00,White Bear Lake North High School,JV,Boys,White Bear Lake,Woodbury
234-HSB24,09/24/2024,15:45:00,Hastings High School,JV,Boys,Hastings,Hill-Murray
235-HSG24,09/24/2024,17:15:00,Hastings High School,JV,Girls,Hastings,Hill-Murray
519-HSB24,09/25/2024,17:15:00,St Thomas Academy,C-Squad,Boys,St Thomas Academy,Two Rivers
366-HSB24,09/26/2024,15:45:00,Hill-Murray High School,JV,Girls,Hill-Murray,Two Rivers
235-HSB24,09/26/2024,17:15:00,Hastings High School,JV,Boys,Hastings,St Thomas Academy
184-HSG24,09/26/2024,17:00:00,Forest Lake High School,Varsity,Girls,Forest Lake,White Bear Lake
188-HSB24,09/26/2024,19:00:00,Forest Lake High School,Varsity,Boys,Forest Lake,White Bear Lake
367-HSB24,09/26/2024,17:15:00,Hill-Murray High School,JV,Boys,Hill-Murray,Two Rivers
184-HSB24,09/26/2024,19:00:00,Hastings High School,Varsity,Boys,Hastings,St Thomas Academy
549-HSB24,09/27/2024,15:45:00,Two Rivers High School,C-Squad,Girls,Two Rivers,Hill-Murray
550-HSB24,09/27/2024,17:15:00,Two Rivers High School,C-Squad,Boys,Two Rivers,Hill-Murray
524-HSB24,09/28/2024,12:00:00,St Thomas Academy,B-Squad,Boys,St Thomas Academy,Roseville
423-HSB24,09/28/2024,13:00:00,Tartan High School,Varsity,Boys,Tartan,Zimmerman
551-HSB24,09/30/2024,15:45:00,Two Rivers High School,B-Squad,Boys,Two Rivers,St Thomas Academy
597-HSB24,09/30/2024,16:00:00,White Bear Lake North High School,Grade 9,Boys,White Bear Lake,Stillwater
598-HSB24,09/30/2024,17:15:00,White Bear Lake North High School,Grade 9,Girls,White Bear Lake,Stillwater`
		const october = 
`Game ID,Date,Start Time,Venue,Age Group,Gender,Home Team,Away Team
248-HSB24,10/01/2024,15:45:00,Two Rivers High School,JV,Boys,Two Rivers,Simley
525-HSB24,10/01/2024,16:00:00,St Thomas Academy,B-Squad,Boys,St Thomas Academy,Tartan
599-HSB24,10/01/2024,16:00:00,White Bear Lake North High School,JV,Boys,White Bear Lake,Stillwater
373-HSB24,10/01/2024,16:15:00,Hill-Murray High School,B-Squad,Boys,Hill-Murray,Rosemount
526-HSB24,10/01/2024,16:15:00,St Thomas Academy,JV,Boys,St Thomas Academy,Tartan
200-HSB24,10/01/2024,17:00:00,Forest Lake High School,Varsity,Boys,Forest Lake,Woodbury
563-HSB24,10/01/2024,17:15:00,North St Paul High School,JV,Boys,North St Paul,Hill-Murray
245-HSG24,10/01/2024,17:15:00,Two Rivers High School,JV,Girls,Two Rivers,Simley
600-HSB24,10/01/2024,17:15:00,White Bear Lake North High School,JV,Girls,White Bear Lake,Stillwater
196-HSB24,10/01/2024,18:00:00,St Thomas Academy,Varsity,Boys,St Thomas Academy,Tartan
194-HSG24,10/01/2024,19:00:00,Forest Lake High School,Varsity,Girls,Forest Lake,Woodbury
236-HSG24,10/02/2024,15:45:00,Hastings High School,C-Squad,Girls,Hastings,South St Paul
374-HSB24,10/02/2024,15:45:00,Hill-Murray High School,C-Squad,Girls,Hill-Murray,North St Paul
413-HSB24,10/02/2024,15:45:00,Simley High School,C-Squad,Boys,Simley,Two Rivers
236-HSB24,10/02/2024,17:15:00,Hastings High School,C-Squad,Boys,Hastings,South St Paul
414-HSB24,10/02/2024,17:15:00,Simley High School,C-Squad,Girls,Simley,Two Rivers
209-HSG24,10/02/2024,18:00:00,Two Rivers High School,Varsity,Girls,Two Rivers,Mahtomedi
376-HSB24,10/02/2024,19:00:00,Hill-Murray High School,B-Squad,Boys,Hill-Murray,Hill-Murray
415-HSB24,10/03/2024,15:45:00,Simley High School,JV,Boys,Simley,Hastings
416-HSB24,10/03/2024,17:15:00,Simley High School,JV,Girls,Simley,Hastings
601-HSB24,10/03/2024,17:15:00,White Bear Lake North High School,B-Squad,Boys,White Bear Lake,Cretin-Derham Hall
207-HSB24,10/03/2024,19:00:00,Two Rivers High School,Varsity,Boys,Two Rivers,Mahtomedi
426-HSB24,10/05/2024,10:00:00,Ojibway Park,JV,Boys,Woodbury,St Paul Central
565-HSB24,10/05/2024,11:00:00,North St Paul High School,JV,Boys,North St Paul,Saint Anthony Village
215-HSB24,10/05/2024,13:00:00,South St Paul High School,JV,Girls,South St Paul,Duluth East
250-HSB24,10/05/2024,13:00:00,Irondale High School,Varsity,Boys,Irondale,St Cloud Apollo`

		const calendars = {
			"august": august,
			"september": september,
			"october": october,
		}
        
        function parse_csv(csv) {
            const lines = csv.split("\n");
            const headers = lines[0].split(",");
            const body = lines.slice(1);
            const data = [];
            for (line of body) {
                let datum = {}
                let line_data = line.split(",");
                for (let i = 0; i < headers.length; i++) {
                    datum[headers[i]] = line_data[i];
                }
                data.push(datum);
            }
            return data;
        }

        function handleVenueCheckboxChange(evt) {
            // check all game checkboxes
            let div = evt.target.parentElement.parentElement;
            let checkboxes = div.getElementsByClassName("card-checkbox");
            for (let checkbox of checkboxes) {
                if (checkbox.checked != evt.target.checked) {
                    checkbox.checked = evt.target.checked;
                    var event = new Event("change");
                    checkbox.dispatchEvent(event);
                }
            }

            // permanent check
            const parent = evt.target.parentElement;
            const index = [].indexOf.call(parent.childNodes, evt.target);
            if (evt.target.checked) {
                evt.target.outerHTML = evt.target.outerHTML.replace(">", " checked>");
            } else {
                evt.target.outerHTML = evt.target.outerHTML.replace(' checked=""', "");
            }
            parent.childNodes[index].addEventListener("click", handleVenueCheckboxChange);


        }

        function handleGameCheckboxChange(evt) {
            const parent = evt.target.parentElement;
            const index = [].indexOf.call(parent.childNodes, evt.target);
            const div = evt.target.parentElement.parentElement.parentElement;
            const selectedGamesEl = div.getElementsByClassName("selected-games")[0];
            const totalGamesEl = div.getElementsByClassName("total-games")[0];
            const selectedGames = parseInt(selectedGamesEl.innerText);
            const totalGames = parseInt(totalGamesEl.innerText);
            if (evt.target.checked) {
                evt.target.outerHTML = evt.target.outerHTML.replace(">", " checked>");
                selectedGamesEl.innerText = selectedGames + 1;
                if (selectedGames + 1 === totalGames) {
                    let checkbox = div.getElementsByClassName("venue-checkbox")[0];
                    checkbox.checked = true;
                }
                
            } else {
                evt.target.outerHTML = evt.target.outerHTML.replace(' checked=""', "");
                selectedGamesEl.innerText = selectedGames - 1;
                let checkbox = div.getElementsByClassName("venue-checkbox")[0];
                checkbox.checked = false;
            }
            parent.childNodes[index].addEventListener("change", handleGameCheckboxChange);

        }

        function createVenueContainer(venue, cardData) {
            divEl = document.createElement("div");
            listEl = document.createElement("ul");
            listEl.className="card-list";

            let venueEl = document.createElement("p");
            venueEl.className = "card-venue closed";
            venueEl.addEventListener("click", (evt) => {
                if (evt.target.className.search("venue-checkbox")){
                    evt.currentTarget.classList.toggle("closed");
                }
            });

            let venueCheckbox = document.createElement("input");
            venueCheckbox.type = "checkbox";
            venueCheckbox.className = "venue-checkbox";
            venueCheckbox.addEventListener("click", handleVenueCheckboxChange);
            venueEl.appendChild(venueCheckbox);

            let textNode = document.createTextNode(venue);
            venueEl.appendChild(textNode);

            let gameRatioSpan = document.createElement("span");
            gameRatioSpan.className = "game-ratio";
            textNode = document.createTextNode("(");
            gameRatioSpan.appendChild(textNode);

            let selectedGames = document.createElement("span");
            selectedGames.className = "selected-games";
            selectedGames.innerText = "0";
            gameRatioSpan.appendChild(selectedGames);

            textNode = document.createTextNode("/");
            gameRatioSpan.appendChild(textNode);

            
            let totalGamesEl = document.createElement("span");
            totalGamesEl.className = "total-games";
            let totalGames = cardData.filter((a) => {return a["Venue"] === venue;}).length;
            totalGamesEl.innerText = `${totalGames}`
            gameRatioSpan.appendChild(totalGamesEl);

            textNode = document.createTextNode(")");
            gameRatioSpan.appendChild(textNode);
            
            venueEl.appendChild(gameRatioSpan);
            divEl.appendChild(venueEl);
            divEl.appendChild(listEl);

            return divEl;

        }

        function appendGameToVenueContainer(venueContainer, data) {

            let listEl = venueContainer.getElementsByTagName("ul")[0];

            const listItem = document.createElement("li");
            const label = document.createElement("label");
            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.id = `availability-${data["Game ID"]}`;
            checkbox.name = data["Game ID"];
            checkbox.className = "card-checkbox";
            checkbox.addEventListener("change", handleGameCheckboxChange);
            label.innerText = `${data["Gender"]} ${data["Level"]} ${data["Time"]}`;
            label.htmlFor = checkbox.id;
            label.className = "card-label";
            listItem.appendChild(checkbox);
            listItem.appendChild(label);
            listItem.className = "card-game";
            listEl.appendChild(listItem);
        }

        function createCard(day, cardData){
            let gamesAdded = 0;
            const cardEl = document.createElement("div");
            cardEl.className = "calendar-card";
            if (day > 0) {
                let dayEl = document.createElement("div");
                dayEl.className = "calendar-date";
                dayEl.innerText = day;
                cardEl.appendChild(dayEl);
            }
            if (cardData) {
                let prevVenue = "";
                let venueContainer = null;
                for (data of cardData) {
                    let venue = data["Venue"];

                    if (venue != prevVenue) {
                        venueContainer = createVenueContainer(venue, cardData);
                        cardEl.appendChild(venueContainer);
                        prevVenue = venue;
                    }

                    appendGameToVenueContainer(venueContainer, data);
                    gamesAdded ++;

                }
            }
            return { cardEl, gamesAdded };
        }

        function generateCalendars() {
            for (let key in calendars) {

                const calendar = document.getElementById(`${key}-cards`);
                if (calendar.innerHTML != "") {
                    continue;
                }

                const calendarData = parse_csv(calendars[key]);
                calendarData.sort((a, b) => new Date(a["Date"] + " " + a["Time"]) < new Date(b["Date"] + " " + b["Time"]) ? 1 : -1);
                calendarData.sort((a, b) => a["Venue"] < b["Venue"] ? 1 : -1);
                calendarData.sort((a, b) => new Date(a["Date"]) < new Date(b["Date"]) ? 1 : -1);

                const date = new Date(`${key} 1, 2024`);

                let cards = 0;
                let totalGames = calendarData.length;
                let totalGamesAdded = 0;

                for (let i = 0; i < date.getDay(); i ++) {
                    let { cardEl, gamesAdded } = createCard(0);
                    calendar.appendChild(cardEl);
                    cards ++;
                }

                do {
                    let cardData = [];
                    if (calendarData.length == 0) {
                        break;
                    }
                    let game = calendarData.pop();
                    let gameDate = new Date(game["Date"]);
                    while (gameDate.valueOf() == date.valueOf()) {
                        cardData.push(game);
                        if (calendarData.length == 0) {
                            break;
                        }
                        game = calendarData.pop();
                        gameDate = new Date(game["Date"]);
                    }
                    calendarData.push(game);

                    let { cardEl, gamesAdded } = createCard(date.getDate(), cardData);
                    totalGamesAdded += gamesAdded;
                    calendar.appendChild(cardEl);
                    cards ++;
                    date.setDate(date.getDate() + 1);

                } while (date.getDate() > 1);

                while (cards < 7 * 5) {
                    let { cardEl, gamesAdded } = createCard(0);
                    calendar.appendChild(cardEl);
                    cards ++;
                }
                if (totalGamesAdded != totalGames) {
                    alert("something went wrong");
                }
            }
        }

        let page = "home";
        const pages = ["home", "august", "september", "october"];

        function switchPage(page) {
            let homepage = document.getElementById("homepage");
            let calendarpage = document.getElementById("calendar-main");
            let augustCards = document.getElementById("august-cards");
            let septemberCards = document.getElementById("september-cards");
            let octoberCards = document.getElementById("october-cards");
            if (page === "home") {
                homepage.style.display = "block";
                calendarpage.style.display = "none";
            } else {
                homepage.style.display = "none";
                calendarpage.style.display = "block";
                if (page === "august") {
                    augustCards.style.display = "grid";
                    septemberCards.style.display = "none";
                    octoberCards.style.display = "none";
                    document.getElementById("calendar-title").innerText = "August";
                } else if (page === "september") {
                    augustCards.style.display = "none";
                    septemberCards.style.display = "grid";
                    octoberCards.style.display = "none";
                    document.getElementById("calendar-title").innerText = "September";
                } else if (page === "october") {
                    augustCards.style.display = "none";
                    septemberCards.style.display = "none";
                    octoberCards.style.display = "grid";
                    document.getElementById("calendar-title").innerText = "October";
                }
            }

            let index = pages.indexOf(page);
            const nextBtn = document.getElementById("next-btn");
            const prevBtn = document.getElementById("previous-btn");
            if (index === pages.length-1) {
                nextBtn.disabled = true;
            } else {
                nextBtn.disabled = false;
            }
            if (index == 0) {
                prevBtn.disabled = true;
            } else {
                prevBtn.disabled = false;
            }
        }

        function nextPage() {
            let index = pages.indexOf(page);
            if (index == pages.length - 1) {
                alert("Already at the last page!");
                return;
            } else {
                page = pages[index + 1];
                switchPage(page);
            }
        }
        function previousPage() {
            let index = pages.indexOf(page);
            if (index == 0) {
                alert("Already at the first page!");
                return;
            } else {
                page = pages[index - 1];
                switchPage(page);
            }
        }

        function saveFile(evt) {
            const nameField = document.getElementById("referee-name");
            if (nameField == null || nameField.value === "") {
                evt.preventDefault();
                alert("You must fill out the referee name field on the first page!");
            } else {
                let name = nameField.value.replaceAll(" ", "_");
                name = name.replaceAll("[^A-z_]", "");
                evt.target.download = name;
                evt.target.href='data:text/html;charset=UTF-8,'+encodeURIComponent(document.documentElement.outerHTML)
            }
        }

        function downloadAvailability(evt) {
            const nameField = document.getElementById("referee-name");
            if (nameField == null || nameField.value === "") {
                evt.preventDefault();
                alert("You must fill out the referee name field on the first page!");
            } else {

                let name = nameField.value.replaceAll(" ", "_");
                let json = {
                    name: nameField.value,
                    availabileFor: [],
                };
                let checkboxes = document.getElementsByClassName("card-checkbox");
                for (let checkbox of checkboxes) {
                    if (checkbox.checked) {
                        json.availabileFor.push(checkbox.name);
                    }
                }
                name = name.replaceAll("[^A-z_]", "");
                evt.target.download = name;
                evt.target.href='data:application/json;charset=UTF-8,'+JSON.stringify(json);
            }
        }

        switchPage("home");
        generateCalendars();
        window.addEventListener("beforeunload", function (e) {
            var confirmationMessage = 'It looks like you have been editing something. '
                                    + 'If you leave before saving, your changes will be lost.';

            (e || window.event).returnValue = confirmationMessage; //Gecko + IE
            return confirmationMessage; //Gecko + Webkit, Safari, Chrome etc.
        });
    </script>
</html>
